---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const reviews = await getCollection('reviews');
  return reviews.map(review => ({
    params: { slug: review.slug },
    props: { review },
  }));
}

const { review } = Astro.props;
const { Content } = await review.render();

const formattedDate = review.data.date.toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric'
});

const baseUrl = import.meta.env.BASE_URL;
---

<BaseLayout title={review.data.title} description={review.data.description}>
  <article class="container-custom py-12">
    <!-- Header -->
    <header class="max-w-4xl mx-auto mb-12">
      <div class="mb-4">
        <a href={`${baseUrl}/reviews/`} class="text-soft-indigo hover:text-sage transition text-sm font-medium">
          ‚Üê Back to Reviews
        </a>
      </div>

      <h1 class="text-4xl md:text-5xl font-bold mb-4">{review.data.title}</h1>
      
      <div class="flex flex-wrap items-center gap-4 text-slate-400 mb-8">
        <time datetime={review.data.date.toISOString()}>
          {formattedDate}
        </time>
        <span class="px-3 py-1 bg-soft-indigo/20 text-soft-indigo rounded-full text-sm font-medium">
          Q{review.data.quarter} - Week {review.data.week}
        </span>
        <span class="px-3 py-1 bg-sage/20 text-sage rounded-full text-sm font-medium">
          {review.data.weekProgress}% Progress
        </span>
      </div>

      <!-- Quick Summary Cards -->
      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="card bg-sage/10 border-sage/30">
          <div class="text-sage font-semibold mb-2">‚úÖ Wins</div>
          <div class="text-2xl font-bold">{review.data.wins.length}</div>
        </div>
        <div class="card bg-orange-500/10 border-orange-500/30">
          <div class="text-orange-400 font-semibold mb-2">üöß Challenges</div>
          <div class="text-2xl font-bold">{review.data.challenges.length}</div>
        </div>
        <div class="card bg-soft-indigo/10 border-soft-indigo/30">
          <div class="text-soft-indigo font-semibold mb-2">üéØ Focus Areas</div>
          <div class="text-2xl font-bold">{review.data.nextWeekFocus.length}</div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <div class="max-w-4xl mx-auto">
      <div class="card">
        <div class="prose prose-lg max-w-none">
          <Content />
        </div>
      </div>
    </div>

    <!-- Back Navigation -->
    <div class="max-w-4xl mx-auto mt-12 pt-8 border-t border-slate-700">
      <a href={`${baseUrl}reviews/`} class="btn btn-secondary">
        ‚Üê All Reviews
      </a>
    </div>
  </article>
</BaseLayout>
